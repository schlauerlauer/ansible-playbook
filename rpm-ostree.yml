---

- name: "rpm-ostree update"
  become: true
  command: rpm-ostree update
  vars:
    cond: "{{ rpm_ostree_update }}"
  when: cond
- name: "rpm-ostree install packages"
  become: true
  command: rpm-ostree install {{ item }}
  with_items: "{{ rpm-ostree }}"
  register: result
  vars:
    cond: "{{ rpm_ostree_install }}"
  when: cond
  failed_when:
    - result.rc != 0
    - '"is already requested" not in result.stdout'