---

- name: toolbox create
  command: "toolbox -y create"
  register: result
  become: false
  failed_when:
    - result.rc != 0
    - '"already exists" not in result.stderr' 

- name: toolbox list
  command: "toolbox list"
  register: result
  become: false
  become_user: "{{ user }}"

- name: fail if toolbox not present
  fail:
    msg: "toolbox container not present"
  when: result.rc != 0 or "registry.fedoraproject.org" not in result.stdout

- name: Update toolbox dnf
  command: toolbox run sudo dnf -y update
  become_user: "{{ user }}"

- name: Update toolbox dnf
  command: toolbox run sudo dnf -y upgrade
  become_user: "{{ user }}"